<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="不要歧视、少抱怨、别硬碰硬、别贬低别人工作、互相帮助！"><title>数据库操作 | 葛镇榕的博客</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">数据库操作</h1><a id="logo" href="/.">葛镇榕的博客</a><p class="description">没有人能阻止你成功 除了你自己</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索..."></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">数据库操作</h1><div class="post-meta"><span class="date">Nov 25, 2017</span><span class="category"><a href="/categories/总结/">总结</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i> Hits</i></i></span><a href="/2017/11/25/数据库操作/#comments" class="comment-count">留言</a></div><div class="post-content"><p><center>数据库操作</center><br><a id="more"></a></p>
<p>iOS目前我们常用到的数据库有<strong>FMDB</strong>、<strong>WCDB</strong>、<strong>cocoaData</strong>和<strong>Realm</strong>,我常用到的是FMDB、和WCDB，现在闲暇时间做一下总结。</p>
<h3 id="FMDB"><a href="#FMDB" class="headerlink" title="FMDB"></a>FMDB</h3><p><img src="/uploads/140853.png" alt="model"></p>
<h4 id="主要介绍"><a href="#主要介绍" class="headerlink" title="主要介绍"></a>主要介绍</h4><p>FMDB是一个和iOS的SQLite数据库操作相关的第三方框架。主要把C语言操作数据库的代码用OC进行了封装。使用者只需调用该框架的API就能用来创建并连接数据库，创建表，查询等。</p>
<h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><blockquote>
<p>1、轻量级，灵活。不消耗太多性能<br><br>2、FMDB将C语言的iOS系统的SQLite数据库的操作代码用OC进行封装，面向对象，容易理解和使用<br><br>3、提供了线程不安全的解决方案。<br></p>
</blockquote>
<h4 id="框架介绍"><a href="#框架介绍" class="headerlink" title="框架介绍"></a>框架介绍</h4><ol>
<li>FMDatabase，一个FMDatabase对象就代表一个单独的SQLite数据库，用来执行SQL语句</li>
<li>FMResultSet 使用FMDatabase执行查询后的结果集</li>
<li>FMDatabaseQueue 用于在多线程中执行多个查询或更新，它是线程安全的</li>
</ol>
<h4 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h4><p>首先创建一个Model</p>
<p><img src="/uploads/WX20171125-141648.png" alt="model"></p>
<p>首先我封装的demo中封装到单例中</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//创建表是否成功</span></div><div class="line">-(<span class="built_in">BOOL</span>)openFMDBName:(<span class="built_in">NSString</span> *)pathStr;</div><div class="line"><span class="comment">/**</span></div><div class="line"> *  增加</div><div class="line"> */</div><div class="line">-(<span class="built_in">BOOL</span>)insetTitle:(<span class="keyword">id</span>)model withPath:(<span class="built_in">NSString</span> *)pathStr;</div><div class="line"><span class="comment">/**</span></div><div class="line"> *  删除   根据userid进行删除</div><div class="line"> */</div><div class="line">-(<span class="keyword">void</span>)deleteWithTitle:(<span class="built_in">NSString</span> *)pathStr withUserID:(<span class="built_in">NSString</span> *)userId;</div><div class="line"><span class="comment">/**</span></div><div class="line"> *  删除所有数据</div><div class="line"> */</div><div class="line">-(<span class="keyword">void</span>)deleteWithTitle:(<span class="built_in">NSString</span> *)pathStr;</div><div class="line"><span class="comment">/**</span></div><div class="line"> *  更新数据   修改</div><div class="line"> */</div><div class="line">-(<span class="keyword">void</span>)updateWithModel:(<span class="keyword">id</span>)model;</div><div class="line"><span class="comment">/**</span></div><div class="line"> *  条件查询数据</div><div class="line"> */</div><div class="line">-(<span class="keyword">void</span>)selectWithTitle:(<span class="built_in">NSString</span> *)userId withUserID:(<span class="built_in">NSString</span> *)pathStr;</div><div class="line"><span class="comment">/**</span></div><div class="line"> *  查询所有数据</div><div class="line"> *</div><div class="line"> */</div><div class="line">-(<span class="keyword">void</span>)selectAllMethod:(<span class="built_in">NSString</span> *)pathStr withBlock:(<span class="keyword">void</span>(^)(<span class="keyword">id</span> Success))block;</div><div class="line"><span class="comment">//查询数据(去除重复数据)</span></div><div class="line">-(<span class="built_in">NSArray</span> *)queryDataWithTableName:(<span class="built_in">NSString</span> *)pathStr keyword:(<span class="built_in">NSString</span> *)keyword;</div></pre></td></tr></table></figure>
<p>添加数据的时候，将汉字转化为拼音，在根据sql语句中like进行查找，做到本地搜索，查询。</p>
<h3 id="WCDB"><a href="#WCDB" class="headerlink" title="WCDB"></a>WCDB</h3><p>WCDB是微信官方的移动端数据库组件，致力于提供一个高效、易用、完整的移动端存储方案。 </p>
<h4 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h4><ol>
<li>易用，WCDB支持一句代码即可将数据取出并组合为object。<br></li>
<li>WINQ(WCDB语言集成查询)：通过WINQ，开发者无须为了拼接SQL的字符串而写一大坨胶水代码。<br></li>
<li>ORM(Object Relational Mapping)：WCDB支持灵活、易用的ORM。开发者可以很便捷地定义表、索引、约束，并进行增删改查操作。<br></li>
<li>高效，WCDB通过框架层和sqlcipher源码优化，使其更高效的表现。</li>
<li>多线程高并发：WCDB支持多线程读与读、读与写并发执行，写与写串行执行。</li>
</ol>
<h4 id="框架介绍-1"><a href="#框架介绍-1" class="headerlink" title="框架介绍"></a>框架介绍</h4><p>WCDB提供了三个基础类进行数据库操作：WCTDatabase、WCTTable、WCTTransaction</p>
<ul>
<li>WCTDatabase表示一个数据库，可以进行所有数据库操作，包括增删查改、表操作、事务、文件操作、损坏修复等。</li>
<li>对于同一个路径的数据库，不同的WCTDatabase、WCTTable、WCTTransaction对象共享同一个WCDB核心。因此，你可以在代码的不同位置、不同线程任意创建不同的基础类对象，WCDB会自动管理它们的共享数据和线程并发</li>
</ul>
<h4 id="实践-1"><a href="#实践-1" class="headerlink" title="实践"></a>实践</h4><ol>
<li>首先和FMDB一样建立model,定义相应的字段，及索引属性，主键等</li>
</ol>
<p><img src="/uploads/WX20171125-17091.png" alt="model"></p>
<ol>
<li>利用宏定义绑定到表的类将一个已有的OC类进行QRM绑定的过程（WCTTableCoding），需要绑定到表中的字段在这里声明，在.mm中去绑定</li>
</ol>
<p><img src="/uploads/20171125-170714.png" alt="model"></p>
<p>3.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//关闭数据库</span></div><div class="line">+(<span class="keyword">void</span>)killDB;</div><div class="line"></div><div class="line"><span class="comment">//添加数据</span></div><div class="line">- (<span class="built_in">BOOL</span>)insertUser:(WCDModel*)mod;</div><div class="line"></div><div class="line"><span class="comment">//更新所有的数据</span></div><div class="line">- (<span class="built_in">BOOL</span>)updateUser:(WCDModel*)mod;</div><div class="line"></div><div class="line"><span class="comment">//根据userid进行更新数据</span></div><div class="line">- (<span class="built_in">BOOL</span>)updateAgeAndUserIDWithMod:(WCDModel*)mod;</div><div class="line"></div><div class="line"><span class="comment">//通过model进行删除</span></div><div class="line">- (<span class="built_in">BOOL</span>)deleteUser:(WCDModel*)mod;</div><div class="line"></div><div class="line"><span class="comment">//删除所有</span></div><div class="line">- (<span class="built_in">BOOL</span>)deleteAllUsers;</div><div class="line"></div><div class="line"><span class="comment">//通过userid查询</span></div><div class="line">- (WCDModel *)getUserWithId:(<span class="built_in">NSString</span>*)userID;</div><div class="line"></div><div class="line"><span class="comment">//根据号查询</span></div><div class="line">- (<span class="built_in">NSArray</span>*)getUsersWithTelNum:(<span class="built_in">NSInteger</span>)telNum;</div><div class="line"></div><div class="line"><span class="comment">//查询所有数据</span></div><div class="line">- (<span class="built_in">NSArray</span>*)getAllUser;</div></pre></td></tr></table></figure>
<p><strong>注意</strong></p>
<ol>
<li>在你的代码文件头引入头文件#import <wcdb wcdb.h="">。<br></wcdb></li>
<li>由于WCDB是基于Objective-C++，因此需要将引用WCDB的源文件后缀.m改为.mm。</li>
</ol>
<p><a href="https://github.com/greatRong6/DatabaseManager">DatabaseManagerDemo地址</a></p>
</div><div class="tags"><a href="/tags/iOS/">iOS</a><a href="/tags/总结/">总结</a></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/2018/05/04/iOS多图片下载/" class="pre">iOS多图片下载</a><a href="/2017/09/24/iPhone-X-设计适配指南和iOS-11-新特性/" class="next">iPhone X 设计适配指南和iOS 11 新特性</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#FMDB"><span class="toc-text">FMDB</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#主要介绍"><span class="toc-text">主要介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#优点"><span class="toc-text">优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#框架介绍"><span class="toc-text">框架介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实践"><span class="toc-text">实践</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WCDB"><span class="toc-text">WCDB</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#优点-1"><span class="toc-text">优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#框架介绍-1"><span class="toc-text">框架介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实践-1"><span class="toc-text">实践</span></a></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/01/07/CocoaPods-升级报错/">CocoaPods 升级报错</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/06/命令Xcode自动打包/">命令Xcode自动打包</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/07/对时间的归档/">对时间的归档</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/07/iOS9以上的系统判断设备上是否有安装某app/">iOS9以上的系统判断设备上是否有安装某app</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/16/App应用内地图跳转/">App应用内地图跳转</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/04/iOS多图片下载/">iOS多图片下载</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/25/数据库操作/">数据库操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/24/iPhone-X-设计适配指南和iOS-11-新特性/">iPhone X 设计适配指南和iOS 11 新特性</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/23/iOS推送集成/">iOS推送集成</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/21/ReactiveCocoa上手/">ReactiveCocoa上手</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CocoaPods/">CocoaPods</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git流程/">git流程</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/学习/">学习</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/总结/">总结</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/文件操作/">文件操作</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/经验总结/">经验总结</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/CocoaPods/" style="font-size: 15px;">CocoaPods</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/文件操作/" style="font-size: 15px;">文件操作</a> <a href="/tags/学习/" style="font-size: 15px;">学习</a> <a href="/tags/Swift/" style="font-size: 15px;">Swift</a> <a href="/tags/总结/" style="font-size: 15px;">总结</a> <a href="/tags/归档/" style="font-size: 15px;">归档</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://baiduhidevios.github.io/2017/05/07/2017-05-07%E6%8A%80%E6%9C%AF%E5%91%A8%E6%8A%A5/" title="百度技术周报" target="_blank">百度技术周报</a><ul></ul><a href="http://blog.csdn.net/q199109106q/article/details/8615661" title="MJ的博客" target="_blank">MJ的博客</a><ul></ul><a href="https://github.com/ChenYilong" title="iOS程序犭袁" target="_blank">iOS程序犭袁</a><ul></ul><a href="http://ios.jobbole.com/84388/" title="iOS 开源库" target="_blank">iOS 开源库</a><ul></ul><a href="http://blog.devtang.com/" title="唐巧的博客" target="_blank">唐巧的博客</a><ul></ul><a href="hhttp://blog.cnbang.net/archives/" title="腾讯大牛(bang's)" target="_blank">腾讯大牛(bang's)</a><ul></ul><a href="http://www.skyfox.org/" title="天狐博客" target="_blank">天狐博客</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">greatrong.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script></body></html>